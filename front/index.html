<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ì–ª–∞–≤–Ω–∞—è</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>

<div class="sidebar">
    <a href="http://51.250.18.211/index.html">
        <span class="icon icon-home"></span>
        <span class="text">–ì–ª–∞–≤–Ω–∞—è</span>
    </a>

    <a href="http://51.250.18.211/chat.html">
        <span class="icon icon-add"></span>
        <span class="text">–°–æ–æ–±—â–µ–Ω–∏—è</span>
    </a>
    <a href="http://51.250.18.211/post_user_auth.html">
        <span class="icon icon-notifications"></span>
        <span class="text">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</span>
    </a>
    <a href="http://51.250.18.211/user.html">
        <span class="icon icon-profile"></span>
        <span class="text">–ú–æ–∏ –¥—Ä—É–∑—å—è</span>
    </a>
</div>
    <div id="posts"></div>

     <div id="chat_window" style="display: none;">
        <h1>–ß–∞—Ç —Å: <span id="chat_with"></span></h1>
        <div id="chat_history">
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ -->
            <div id="chat-container"></div>
        </div>
        <textarea id="message_content"></textarea>
        <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
        <button onclick="closeChat()">–ó–∞–∫—Ä—ã—Ç—å —á–∞—Ç</button>
    </div>
    <div id="chat_list_window" style="display: none;">
        <h2>–í–∞—à–∏ —á–∞—Ç—ã</h2>
        <input type="text" placeholder="–ü–æ–∏—Å–∫" id="search_chat" onkeyup="filterChats()">
        <div id="chat_list"></div>
        <button onclick="closeChatList()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
<script>

    const token = localStorage.getItem("access_token");
    let div_posts = document.getElementById("posts");


    const get_posts = async () => {
        const response = await send(token);
        if (response.status === 401) location.replace("/auth/");
        const posts = (await response.json()).posts;
        div_posts.innerHTML = ""; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ—Å—Ç—ã
        for (let post of posts) {
            let imgs = ``;
            for (let image of post.images) {
                imgs += `
                    <div class="image-container">
                        <img src="http://51.250.18.211/api/v1/media_files/${image}" class="post-image">
                    </div>
                `;
            }
            const formattedDateTime = formatDateTime(post.created_at);
            const heartIcon = post.liked ? '‚ù§Ô∏è' : 'ü§ç'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–º–∞–π–ª—ã –¥–ª—è –ª–∞–π–∫–æ–≤
            const div_post = `<div>
${imgs}
<strong class="post-author">–ê–≤—Ç–æ—Ä:</strong>
<span class="author-name">${post.author_name}</span><br>${post.author_name}<br>
<button class="subscribe_button" id="subscribe${post.author_id}">
${post.is_subscribed ? '–û—Ç–ø–∏—Å–∞—Ç—å—Å—è' : '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è'}
</button>
<button class="chat_button" id="chat${post.author_id}" onclick="startChat(${post.author_id}, '${post.author_name}')">–°–æ–æ–±—â–µ–Ω–∏–µ</button><br>
<strong class="post-date">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:</strong>
<span class="date">${formattedDateTime}</span><br>
<strong class="post-description-label">–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
<span class="post-content">${post.content}</span><br>
<span class="count_likes" id="count_likes${post.id}">${post.count_likes}</span>
<button onclick="switch_like('like${post.id}')" class="like_button" id="like${post.id}">
${heartIcon}
</button>
<div class="post_comments" id="post_comments${post.id}">
<p style="color: blue;" class="count_comments" id="count_comments${post.id}" onclick="open_comments(${post.id})">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${post.count_comments})</p>
</div>
</div>`;
            div_posts.innerHTML += div_post;

        }
        renderSubscriptionButtons(posts);
        check_likes(posts);
    };
    const fetchSubscription = async (token, authorId, subscribe) => {
        const url = `http://51.250.18.211/api/v1/users/${authorId}/${subscribe ? 'subscribe/' : 'unsubscribe/'}`;
        return await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            }
        });
    };
    const fetchUserData = async (token) => {
        const url = 'http://51.250.18.211/api/v1/users/test/';
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const data = await response.json();
            console.log("User data:", data);
            return data;
        } else {
            console.error("Failed to fetch user data:", await response.text());
        }
    };
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("access_token");
        const userData = await fetchUserData(token);

        if (userData) {
            const user_id = userData.user_id;
            console.log("Fetched user_id:", user_id);
            localStorage.setItem("user_id", user_id);

            // –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ user_id –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            const storedUserId = localStorage.getItem("user_id");
            console.log("User ID after fetching user data:", storedUserId);
        }
    });
    const renderSubscriptionButtons = (posts) => {
        posts.forEach(post => {
            const button = document.getElementById(`subscribe${post.author_id}`);
            if (button) {
                if (post.is_subscribed) {
                    button.textContent = "–û—Ç–ø–∏—Å–∞—Ç—å—Å—è";
                    button.classList.add("subscribed"); // –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å subscribed
                    button.onclick = () => {
                        unsubscribeFromAuthor(post);

                    };
                } else {
                    button.textContent = "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è";
                    button.classList.remove("subscribed"); // —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å subscribed
                    button.onclick = () => {
                        subscribeToAuthor(post);
                        button.classList.add("subscribed"); // –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å subscribed
                    };
                }
            }
        });
    };
    const subscribeToAuthor = async (post) => {
        const response = await fetchSubscription(token, post.author_id, true);
        if (response.ok) {
            alert("–í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ –∞–≤—Ç–æ—Ä–∞!");
            renderSubscriptionButtons([post]);

            const button = document.getElementById(`subscribe${post.author_id}`);
            button.textContent = "–û—Ç–ø–∏—Å–∞—Ç—å—Å—è";
            button.classList.add("subscribed"); // –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å subscribed
        } else {
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è.");
        }
    };

    const unsubscribeFromAuthor = async (post) => {
        const response = await fetchSubscription(token, post.author_id, true);
        if (response.ok) {
            alert("–í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç –∞–≤—Ç–æ—Ä–∞!");

            const button = document.getElementById(`subscribe${post.author_id}`);
            button.textContent = "–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è";
            button.classList.remove("subscribed"); // —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å subscribed
        } else {
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è.");
        }
    };
    let chatReceiverId;
    let chatReceiverName;
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("access_token");
        const userData = await fetchUserData(token);

        if (userData) {
            const user_id = userData.user_id;
            console.log("Fetched user_id:", user_id);
            localStorage.setItem("user_id", user_id);

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º user_id –≤ —á–∏—Å–ª–æ
            const storedUserId = Number(localStorage.getItem("user_id"));
            console.log("User ID after fetching user data:", storedUserId);
        }
    });

    const currentUserId = Number(localStorage.getItem("user_id"));

    const renderMessage = (message) => {
        const chatContainer = document.getElementById("chat-container");

        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ message.timestamp –≤ —Ñ–æ—Ä–º–∞—Ç–µ UTC
        const messageTime = new Date(message.timestamp);

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ä–µ–º—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ
        const formattedTime = messageTime.toLocaleString('ru-RU', {
            timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone, // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ chatContainer —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (!chatContainer) {
            console.error("chat-container –Ω–µ –Ω–∞–π–¥–µ–Ω.");
            return;
        }

        const messageElement = document.createElement("div");

        if (message.sender_id === currentUserId) {
            messageElement.classList.add("my-message");
            messageElement.innerHTML = `<p>–í—ã: ${message.content}</p><p>${formattedTime}</p>`;
        } else {
            messageElement.classList.add("other-message");
            messageElement.innerHTML = `<p>${message.sender_name}: ${message.content}</p><p>${formattedTime}</p>`;
        }

        chatContainer.appendChild(messageElement);
    };


    const sendMessage = async () => {
        const content = document.getElementById("message_content").value;
        if (!content) {
            alert("–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.");
            return;
        }

        const response = await fetch("http://51.250.18.211/api/v1/users/messages/", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                receiver_id: chatReceiverId,
                sender_id: currentUserId,
                content: content
            })
        });

        if (!response.ok) {
            alert("–û—à–∏–±–∫–∞:\n" + (await response.json()).detail);
        } else {
            document.getElementById("message_content").value = ''; // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
            await loadChatHistory(chatReceiverId, chatReceiverName); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        }
    };
    const closeChat = () => {
        document.getElementById("chat_window").style.display = 'none';
    };




    // –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Ö.
    const loadChatHistory = async (receiverId, receiverName) => {
        if (isNaN(currentUserId)) {
            console.error("Invalid currentUserId:", currentUserId);
            return;
        }

        const response = await fetch("http://51.250.18.211/api/v1/users/chat/", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                receiver_id: receiverId,
                sender_id: currentUserId,
                content: ""
            })
        });

        if (response.ok) {
            const chatHistory = await response.json();
            chatHistory.forEach(message => renderMessage(message));
            const chatHistoryDiv = document.getElementById("chat_history");
            chatHistoryDiv.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

            chatHistoryDiv.innerHTML = chatHistory.map(message => {
                const isAuthor = message.sender_id === currentUserId;
                return `
            <div class="message ${isAuthor ? 'author' : 'receiver'}">
                <p><strong>${isAuthor ? '–í—ã' : receiverName}:</strong> ${message.content}</p>
                <p><em>${new Date(message.timestamp).toLocaleString()}</em></p>
            </div>
        `;
            }).join('');
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight; // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
        } else {
            console.error("Failed to load chat history:", await response.text());
        }
    };


    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —á–∞—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π.
    const startChat = (userId, userName) => {
        console.log("Starting chat with:", userName);
        chatReceiverId = userId;
        chatReceiverName = userName;

        document.getElementById("chat_with").innerText = userName;  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById("chat_window").style.display = 'block';
        loadChatHistory(chatReceiverId, chatReceiverName);

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        // setInterval(() => {
        //     loadChatHistory(chatReceiverId, chatReceiverName);
        // }, 5000);
    };
    const openChatList = () => {
        document.getElementById("chat_list_window").style.display = 'block';
        open_chats(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    };

    const closeChatList = () => {
        document.getElementById("chat_list_window").style.display = 'none';
        window.location.href = 'http://51.250.18.211/user.html';
    };

    // –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Ö –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.
    const open_chats = async () => {
        let chatListDiv = document.getElementById("chat_list");

        try {
            const response = await fetch("http://51.250.18.211/api/v1/users/chats/", {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
            });

            if (!response.ok) {
                const errorText = await response.text();
                console.error("Failed to load chat list");
                console.error("Response status:", response.status);
                console.error("Response text:", errorText);
                return;
            }

            const chats = await response.json();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
            if (!Array.isArray(chats)) {
                console.error("Unexpected response format:", chats);
                return;
            }

            chatListDiv.innerHTML = ""; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤

            for (let chat of chats) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —á–∞—Ç–∞
                if (!chat.receiver_id || !chat.content || !chat.timestamp) {
                    console.error("Unexpected chat object format:", chat);
                    continue;
                }

                const formattedDateTime = formatDateTime(chat.timestamp);
                const userName = await getUserName(chat.receiver_id);

                chatListDiv.innerHTML += `
            <div class="chat-container">
                <div class="chat-header">
                    <span class="chat-user">${userName || 'Unknown'}</span>
                    <span class="chat-date">${formattedDateTime || 'Unknown Date'}</span>
                </div>
                <div class="chat-body">
                    ${chat.content || 'No content'}
                </div>
                <button onclick="startChat(${chat.receiver_id}, '${userName || 'Unknown'}')">–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç</button>
            </div>`;
            }
        } catch (error) {
            console.error("Error fetching chat list:", error);
        }
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ receiver_id
    const getUserName = async (receiverId) => {
        try {
            const response = await fetch(`http://51.250.18.211/api/v1/users/chats/${receiverId}/`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                console.error("Failed to fetch user name");
                return null;
            }

            const user = await response.json();
            return user.username;
        } catch (error) {
            console.error("Error fetching user name:", error);
            return null;
        }
    };

    const check_likes = (posts) => {
        let liked_posts_id = [];
        for (let post of posts)
            if (post.liked) liked_posts_id.push(post.id);
        const dom_likes = document.getElementsByClassName("like_button");
        for (let dom_like of dom_likes) {
            let id = dom_like.id.replace("like", "");
            if (liked_posts_id.includes(Number(id))) {
                add_like(dom_like, true);
            }
        }
    };
    const add_like = (dom_like, ignore_count = false) => {
        let id = dom_like.id.replace("like", "");
        dom_like.classList.add("enabled");
        dom_like.innerHTML = "‚ù§Ô∏è";
        let count_likes = document.getElementById("count_likes" + id);
        if (!ignore_count) {
            sendLike(token, id, true);
            count_likes.innerHTML = String(Number(count_likes.innerHTML) + 1);
        }
    };
    const switch_like = (id) => {
        let domLike = document.getElementById(id);
        if (!domLike) {
            console.error(`Element with id ${id} not found.`);
            return;
        }
        let post_id = id.replace("like", "");

        if (domLike.classList.contains("enabled")) {
            remove_like(domLike);
        } else {
            add_like(domLike);
        }
    };
    const remove_like = (dom_like) => {
        let id = dom_like.id.replace("like", "");
        sendLike(token, id, false);
        dom_like.classList.remove("enabled");
        dom_like.innerHTML = "ü§ç"; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É—Å—Ç–æ–µ —Å–µ—Ä–¥—Ü–µ
        let count_likes = document.getElementById("count_likes" + id);
        count_likes.innerHTML = String(Number(count_likes.innerHTML) - 1);
    };
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ª–∞–π–∫–∞ —á–µ—Ä–µ–∑ API.
    const sendLike = async (token, postId, like) => {
        const url = `http://51.250.18.211/api/v1/posts/${postId}/like/?like=${like}`;
        return await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + token
            },
        });
    };
    const formatDateTime = (isoDateTime) => {
        const date = new Date(isoDateTime);
        const options = {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        };
        return date.toLocaleString('ru-RU', options);
    };


    const open_comments = async (post_id) => {
        let div_comments = document.getElementById("post_comments" + post_id);
        const response = await get_comments(token, post_id);
        let comments = (await response.json()).comments;
        div_comments.innerHTML = "";
        for (let comment of comments) {
            const formattedDateTime = formatDateTime(comment.created_at);
            div_comments.innerHTML += `
            <div class="comment-container">
                <div class="comment-header">
                    <span class="comment-author">${comment.user.fullname}</span>
                    <span class="comment-date">${formattedDateTime}</span>
                </div>
                <div class="comment-body">
                    ${comment.content}
                </div>
                <button class="delete-comment-button" onclick="del_comments(${post_id}, ${comment.id || comment.comment_id})">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!</button>
            </div>
            `;
        }
        div_comments.innerHTML += `
        <br>
        <input type="text" id="text_comment${post_id}"> <button onclick="create_comment(${post_id})">–û—Ç–ø—Ä–∞–≤–∏—Ç—å!</button>
        `;
    };

    const create_comment = async (post_id) => {
        const text = document.getElementById("text_comment" + post_id).value;
        document.getElementById("text_comment" + post_id).value = "";
        if (text !== "") {
            await send_comment(token, post_id, text);
        }
        await open_comments(post_id);
    };

    const send_comment = async (token, post_id, text) => {
        const url = `http://51.250.18.211/api/v1/posts/${post_id}/comments/create/`;
        return await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({content: text})
        });
    };


    const get_comments = async (token, post_id) => {
        const url = `http://51.250.18.211/api/v1/posts/${post_id}/comments/`;
        return await fetch(url, {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });
    };

    const del_comments = async (post_id, comment_id) => {
        if (!comment_id) {
            console.error("comment_id is undefined");
            return;
        }
        const url = `http://51.250.18.211/api/v1/posts/${post_id}/comments/${comment_id}`;
        console.log("DELETE URL:", url);
        const response = await fetch(url, {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });

        if (response.ok) {
            alert("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!");
            await open_comments(post_id); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
        } else {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:", await response.text());
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.");
        }
    };
    const checkToken = () => {
        if (!token) {
            console.error("No access token found");
            location.replace("/auth/");
        }
    };
    const URL = `http://51.250.18.211/api/v1/posts/`;
    const send = async (token) => {
        return await fetch(URL, {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token
            }
        });
    };
    const check_token = () => {
        const token = localStorage.getItem("access_token");
    }


    check_token();
    get_posts();

</script>
</body>
</html>
